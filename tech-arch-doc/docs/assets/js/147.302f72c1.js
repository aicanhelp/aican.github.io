(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{347:function(n,e,s){"use strict";s.r(e);var a=s(0),t=Object(a.a)({},(function(){var n=this,e=n.$createElement,s=n._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"java-nio-框架-netty"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-nio-框架-netty"}},[n._v("#")]),n._v(" Java NIO 框架 - Netty")]),n._v(" "),s("h4",{attrs:{id:"比较好的基于nio的开源框架（netty）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#比较好的基于nio的开源框架（netty）"}},[n._v("#")]),n._v(" 比较好的基于NIO的开源框架（Netty）")]),n._v(" "),s("p",[s("strong",[n._v("优点：")])]),n._v(" "),s("ul",[s("li",[n._v("api简单，开发门槛低")]),n._v(" "),s("li",[n._v("功能强大，内置了多种编码、解码功能")]),n._v(" "),s("li",[n._v("与其它业界主流的NIO框架对比，netty的综合性能最优")]),n._v(" "),s("li",[n._v("社区活跃，使用广泛，经历过很多商业应用项目的考验")]),n._v(" "),s("li",[n._v("定制能力强，可以对框架进行灵活的扩展")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("<dependency>\n     <groupId>org.jboss.netty</groupId>\n     <artifactId>netty</artifactId>\n     <version>3.2.5.Final</version>\n</dependency>\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("p",[s("strong",[n._v("例子：")])]),n._v(" "),s("ul",[s("li",[n._v("服务端。接收客户端请求并将内容打印出来，同时发送一个消息收到回执。")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('public class NettyServer {\n\n    private static int HEADER_LENGTH = 4;\n\n    public void bind(int port) throws Exception {\n\n        ServerBootstrap b = new ServerBootstrap(new NioServerSocketChannelFactory(Executors.newCachedThreadPool(),\n                                                                                  Executors.newCachedThreadPool()));\n\n        // 构造对应的pipeline\n        b.setPipelineFactory(new ChannelPipelineFactory() {\n\n            public ChannelPipeline getPipeline() throws Exception {\n                ChannelPipeline pipelines = Channels.pipeline();\n                pipelines.addLast(MessageHandler.class.getName(), new MessageHandler());\n                return pipelines;\n            }\n        });\n        // 监听端口号\n        b.bind(new InetSocketAddress(port));\n    }\n\n    // 处理消息\n    static class MessageHandler extends SimpleChannelHandler {\n\n        public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception {\n            // 接收客户端请求\n            ChannelBuffer buffer = (ChannelBuffer) e.getMessage();\n            String message = new String(buffer.readBytes(buffer.readableBytes()).array(), "UTF-8");\n            System.out.println("<服务端>收到内容=" + message);\n\n            // 给客户端发送回执\n            byte[] body = "服务端已收到".getBytes();\n            byte[] header = ByteBuffer.allocate(HEADER_LENGTH).order(ByteOrder.BIG_ENDIAN).putInt(body.length).array();\n            Channels.write(ctx.getChannel(), ChannelBuffers.wrappedBuffer(header, body));\n            System.out.println("<服务端>发送回执,time=" + System.currentTimeMillis());\n\n        }\n    }\n\n    public static void main(String[] args) {\n        try {\n            new NettyServer().bind(1088);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        ;\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br")])]),s("ul",[s("li",[n._v("客户端。向服务端发送一个请求，然后打印服务端响应的内容。")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('public class NettyClient {\n\n    private final ByteBuffer readHeader  = ByteBuffer.allocate(4).order(ByteOrder.BIG_ENDIAN);\n    private final ByteBuffer writeHeader = ByteBuffer.allocate(4).order(ByteOrder.BIG_ENDIAN);\n    private SocketChannel    channel;\n\n    public void sendMessage(byte[] body) throws Exception {\n        // 创建客户端通道\n        channel = SocketChannel.open();\n        channel.socket().setSoTimeout(60000);\n        channel.connect(new InetSocketAddress(AddressUtils.getHostIp(), 1088));\n\n        // 客户端发请求\n        writeWithHeader(channel, body);\n\n        // 接收服务端响应的信息\n        readHeader.clear();\n        read(channel, readHeader);\n        int bodyLen = readHeader.getInt(0);\n        ByteBuffer bodyBuf = ByteBuffer.allocate(bodyLen).order(ByteOrder.BIG_ENDIAN);\n        read(channel, bodyBuf);\n        System.out.println("<客户端>收到响应内容：" + new String(bodyBuf.array(), "UTF-8") + ",长度:" + bodyLen);\n    }\n\n    private void writeWithHeader(SocketChannel channel, byte[] body) throws IOException {\n        writeHeader.clear();\n        writeHeader.putInt(body.length);\n        writeHeader.flip();\n        // channel.write(writeHeader);\n        channel.write(ByteBuffer.wrap(body));\n    }\n\n    private void read(SocketChannel channel, ByteBuffer buffer) throws IOException {\n        while (buffer.hasRemaining()) {\n            int r = channel.read(buffer);\n            if (r == -1) {\n                throw new IOException("end of stream when reading header");\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        String body = "客户发的测试请求！";\n        try {\n            new NettyClient().sendMessage(body.getBytes());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br")])]),s("ul",[s("li",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/RPTETiULRAkOS-ZTd6xM2A",target:"_blank",rel:"noopener noreferrer"}},[n._v("Netty入门简介"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=t.exports}}]);