<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL语言 - 基础 | 戴鹏的个人博客</title>
    <meta name="description" content="包含：Java 基础, Java 部分源码, JVM, Spring, Spring Boot, Spring Cloud, 数据库原理, MySQL, ElasticSearch, MongoDB, Docker, k8s, CI&amp;CD, Linux, DevOps, 分布式, 中间件, 开发工具, Git, IDE, 源码阅读，读书笔记, 开源项目...">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.7747ca4d.css" as="style"><link rel="preload" href="/assets/js/app.8de273a3.js" as="script"><link rel="preload" href="/assets/js/2.c16f9978.js" as="script"><link rel="preload" href="/assets/js/64.75a8a6ce.js" as="script"><link rel="prefetch" href="/assets/js/10.919d4ea0.js"><link rel="prefetch" href="/assets/js/100.92c0cb7f.js"><link rel="prefetch" href="/assets/js/101.ae299f1b.js"><link rel="prefetch" href="/assets/js/102.b25b18df.js"><link rel="prefetch" href="/assets/js/103.5c46e54b.js"><link rel="prefetch" href="/assets/js/104.c08cbf65.js"><link rel="prefetch" href="/assets/js/105.1f8b4767.js"><link rel="prefetch" href="/assets/js/106.72f2e471.js"><link rel="prefetch" href="/assets/js/107.52313f56.js"><link rel="prefetch" href="/assets/js/108.d32f0898.js"><link rel="prefetch" href="/assets/js/109.567513ad.js"><link rel="prefetch" href="/assets/js/11.e01e1d1a.js"><link rel="prefetch" href="/assets/js/110.ddabae1a.js"><link rel="prefetch" href="/assets/js/111.c974c446.js"><link rel="prefetch" href="/assets/js/112.10f411b5.js"><link rel="prefetch" href="/assets/js/113.ee732ee7.js"><link rel="prefetch" href="/assets/js/114.40c1ae83.js"><link rel="prefetch" href="/assets/js/115.868459c4.js"><link rel="prefetch" href="/assets/js/116.3201939b.js"><link rel="prefetch" href="/assets/js/117.605b03b3.js"><link rel="prefetch" href="/assets/js/118.4e8c9d9a.js"><link rel="prefetch" href="/assets/js/119.f0b92776.js"><link rel="prefetch" href="/assets/js/12.d45ee59a.js"><link rel="prefetch" href="/assets/js/120.772299fa.js"><link rel="prefetch" href="/assets/js/121.9d4c7a26.js"><link rel="prefetch" href="/assets/js/122.efea4f61.js"><link rel="prefetch" href="/assets/js/123.48191e36.js"><link rel="prefetch" href="/assets/js/124.98d7a95d.js"><link rel="prefetch" href="/assets/js/125.f34bc8da.js"><link rel="prefetch" href="/assets/js/126.e9bcf88d.js"><link rel="prefetch" href="/assets/js/127.ed9f52a2.js"><link rel="prefetch" href="/assets/js/128.643fa3b3.js"><link rel="prefetch" href="/assets/js/129.5162317e.js"><link rel="prefetch" href="/assets/js/13.59e30ed8.js"><link rel="prefetch" href="/assets/js/130.54a56cef.js"><link rel="prefetch" href="/assets/js/131.9c607b7b.js"><link rel="prefetch" href="/assets/js/132.81e138b4.js"><link rel="prefetch" href="/assets/js/133.43a734ef.js"><link rel="prefetch" href="/assets/js/134.eab70448.js"><link rel="prefetch" href="/assets/js/135.1fb34d63.js"><link rel="prefetch" href="/assets/js/136.e87ebc34.js"><link rel="prefetch" href="/assets/js/137.32f9c5a1.js"><link rel="prefetch" href="/assets/js/138.c0667c60.js"><link rel="prefetch" href="/assets/js/139.38393828.js"><link rel="prefetch" href="/assets/js/14.4928fdf3.js"><link rel="prefetch" href="/assets/js/140.6514cc6d.js"><link rel="prefetch" href="/assets/js/141.b55f82be.js"><link rel="prefetch" href="/assets/js/142.ebb9c2c3.js"><link rel="prefetch" href="/assets/js/143.4cfd1836.js"><link rel="prefetch" href="/assets/js/144.e68d93b9.js"><link rel="prefetch" href="/assets/js/145.a1b258ac.js"><link rel="prefetch" href="/assets/js/146.f17dccc5.js"><link rel="prefetch" href="/assets/js/147.302f72c1.js"><link rel="prefetch" href="/assets/js/148.5cd89b42.js"><link rel="prefetch" href="/assets/js/149.d11de771.js"><link rel="prefetch" href="/assets/js/15.d14c599e.js"><link rel="prefetch" href="/assets/js/150.3e298844.js"><link rel="prefetch" href="/assets/js/151.1d769b76.js"><link rel="prefetch" href="/assets/js/152.0d985dc3.js"><link rel="prefetch" href="/assets/js/153.458d2f6c.js"><link rel="prefetch" href="/assets/js/154.7da2b3de.js"><link rel="prefetch" href="/assets/js/155.7d380845.js"><link rel="prefetch" href="/assets/js/156.7756ac98.js"><link rel="prefetch" href="/assets/js/157.2b072c7e.js"><link rel="prefetch" href="/assets/js/158.3e5fa7b5.js"><link rel="prefetch" href="/assets/js/159.9d431703.js"><link rel="prefetch" href="/assets/js/16.e242938b.js"><link rel="prefetch" href="/assets/js/160.4c0457ca.js"><link rel="prefetch" href="/assets/js/161.af041c99.js"><link rel="prefetch" href="/assets/js/162.9b4d3d45.js"><link rel="prefetch" href="/assets/js/163.a766d13f.js"><link rel="prefetch" href="/assets/js/164.c7d5c7d1.js"><link rel="prefetch" href="/assets/js/165.408fa33b.js"><link rel="prefetch" href="/assets/js/166.777120f2.js"><link rel="prefetch" href="/assets/js/167.b680fdbe.js"><link rel="prefetch" href="/assets/js/168.b2bf511e.js"><link rel="prefetch" href="/assets/js/169.5d365aaf.js"><link rel="prefetch" href="/assets/js/17.110bb8c6.js"><link rel="prefetch" href="/assets/js/170.00c05f6d.js"><link rel="prefetch" href="/assets/js/171.9a183b09.js"><link rel="prefetch" href="/assets/js/172.d4267939.js"><link rel="prefetch" href="/assets/js/173.9b999962.js"><link rel="prefetch" href="/assets/js/174.abf0cebd.js"><link rel="prefetch" href="/assets/js/175.9a0d4674.js"><link rel="prefetch" href="/assets/js/176.dbdff737.js"><link rel="prefetch" href="/assets/js/177.d69cea28.js"><link rel="prefetch" href="/assets/js/178.488582e6.js"><link rel="prefetch" href="/assets/js/179.9538a108.js"><link rel="prefetch" href="/assets/js/18.a2703115.js"><link rel="prefetch" href="/assets/js/180.f0bbacd2.js"><link rel="prefetch" href="/assets/js/181.b663985e.js"><link rel="prefetch" href="/assets/js/182.4d5ea84d.js"><link rel="prefetch" href="/assets/js/183.3209bebc.js"><link rel="prefetch" href="/assets/js/184.34db7bbf.js"><link rel="prefetch" href="/assets/js/185.9d21479c.js"><link rel="prefetch" href="/assets/js/186.3477acbe.js"><link rel="prefetch" href="/assets/js/187.05c6a807.js"><link rel="prefetch" href="/assets/js/188.d35c4bf2.js"><link rel="prefetch" href="/assets/js/189.5e374a2c.js"><link rel="prefetch" href="/assets/js/19.c05e66c1.js"><link rel="prefetch" href="/assets/js/190.324e393a.js"><link rel="prefetch" href="/assets/js/191.3251b10d.js"><link rel="prefetch" href="/assets/js/192.4957f20a.js"><link rel="prefetch" href="/assets/js/193.66fd3613.js"><link rel="prefetch" href="/assets/js/194.c2f944c1.js"><link rel="prefetch" href="/assets/js/195.b0d4747f.js"><link rel="prefetch" href="/assets/js/196.e9a02d5b.js"><link rel="prefetch" href="/assets/js/197.5ce57d92.js"><link rel="prefetch" href="/assets/js/198.b3f9c9aa.js"><link rel="prefetch" href="/assets/js/199.6b67f916.js"><link rel="prefetch" href="/assets/js/20.3f1dc9b2.js"><link rel="prefetch" href="/assets/js/200.49d3eb6e.js"><link rel="prefetch" href="/assets/js/201.3b37821f.js"><link rel="prefetch" href="/assets/js/202.de88255d.js"><link rel="prefetch" href="/assets/js/203.42b1e2b0.js"><link rel="prefetch" href="/assets/js/204.5af50f0a.js"><link rel="prefetch" href="/assets/js/205.bd35def5.js"><link rel="prefetch" href="/assets/js/206.2c9a73a5.js"><link rel="prefetch" href="/assets/js/207.021446f3.js"><link rel="prefetch" href="/assets/js/21.6e346200.js"><link rel="prefetch" href="/assets/js/22.2ccaca84.js"><link rel="prefetch" href="/assets/js/23.639d2ae2.js"><link rel="prefetch" href="/assets/js/24.090cdeac.js"><link rel="prefetch" href="/assets/js/25.f62821c9.js"><link rel="prefetch" href="/assets/js/26.de8ca5c4.js"><link rel="prefetch" href="/assets/js/27.01d4f6f7.js"><link rel="prefetch" href="/assets/js/28.0ecc82dd.js"><link rel="prefetch" href="/assets/js/29.400e3d9a.js"><link rel="prefetch" href="/assets/js/3.cc6727c2.js"><link rel="prefetch" href="/assets/js/30.804ab3da.js"><link rel="prefetch" href="/assets/js/31.d9e3e2c6.js"><link rel="prefetch" href="/assets/js/32.02acb6d2.js"><link rel="prefetch" href="/assets/js/33.e69d332c.js"><link rel="prefetch" href="/assets/js/34.9828541e.js"><link rel="prefetch" href="/assets/js/35.e1d22427.js"><link rel="prefetch" href="/assets/js/36.836c7eac.js"><link rel="prefetch" href="/assets/js/37.840bf916.js"><link rel="prefetch" href="/assets/js/38.4f9c0c72.js"><link rel="prefetch" href="/assets/js/39.20a4b3ca.js"><link rel="prefetch" href="/assets/js/4.bb18c8fc.js"><link rel="prefetch" href="/assets/js/40.6676c3ca.js"><link rel="prefetch" href="/assets/js/41.76a8db2c.js"><link rel="prefetch" href="/assets/js/42.40f38ced.js"><link rel="prefetch" href="/assets/js/43.42b908cd.js"><link rel="prefetch" href="/assets/js/44.c0735c12.js"><link rel="prefetch" href="/assets/js/45.fcae7081.js"><link rel="prefetch" href="/assets/js/46.4f719618.js"><link rel="prefetch" href="/assets/js/47.ffb1ed28.js"><link rel="prefetch" href="/assets/js/48.e38f6188.js"><link rel="prefetch" href="/assets/js/49.73b24ed3.js"><link rel="prefetch" href="/assets/js/5.8fd2049c.js"><link rel="prefetch" href="/assets/js/50.e34fdc2f.js"><link rel="prefetch" href="/assets/js/51.cd9a55af.js"><link rel="prefetch" href="/assets/js/52.bcf2b2b6.js"><link rel="prefetch" href="/assets/js/53.ee71d4cf.js"><link rel="prefetch" href="/assets/js/54.6c205972.js"><link rel="prefetch" href="/assets/js/55.3c6de999.js"><link rel="prefetch" href="/assets/js/56.0faf7b7b.js"><link rel="prefetch" href="/assets/js/57.51e7f113.js"><link rel="prefetch" href="/assets/js/58.5934651c.js"><link rel="prefetch" href="/assets/js/59.4fc1b45b.js"><link rel="prefetch" href="/assets/js/6.1ea505d5.js"><link rel="prefetch" href="/assets/js/60.b2a2c3fd.js"><link rel="prefetch" href="/assets/js/61.00e845e4.js"><link rel="prefetch" href="/assets/js/62.f3ad9a06.js"><link rel="prefetch" href="/assets/js/63.ab9673f0.js"><link rel="prefetch" href="/assets/js/65.ab7882e6.js"><link rel="prefetch" href="/assets/js/66.e2059261.js"><link rel="prefetch" href="/assets/js/67.6be270df.js"><link rel="prefetch" href="/assets/js/68.cd3a946d.js"><link rel="prefetch" href="/assets/js/69.40688fbf.js"><link rel="prefetch" href="/assets/js/7.29d58161.js"><link rel="prefetch" href="/assets/js/70.ce72aaf1.js"><link rel="prefetch" href="/assets/js/71.f86efa0e.js"><link rel="prefetch" href="/assets/js/72.ce8bdd09.js"><link rel="prefetch" href="/assets/js/73.45c09070.js"><link rel="prefetch" href="/assets/js/74.d94ec7ad.js"><link rel="prefetch" href="/assets/js/75.a8d855fb.js"><link rel="prefetch" href="/assets/js/76.cfdf8bed.js"><link rel="prefetch" href="/assets/js/77.5fef3c8d.js"><link rel="prefetch" href="/assets/js/78.8620a411.js"><link rel="prefetch" href="/assets/js/79.574418dd.js"><link rel="prefetch" href="/assets/js/8.f48d069a.js"><link rel="prefetch" href="/assets/js/80.f0d7779f.js"><link rel="prefetch" href="/assets/js/81.b79645bf.js"><link rel="prefetch" href="/assets/js/82.a2ebc0a2.js"><link rel="prefetch" href="/assets/js/83.9b29edde.js"><link rel="prefetch" href="/assets/js/84.2c36e875.js"><link rel="prefetch" href="/assets/js/85.fc7b7553.js"><link rel="prefetch" href="/assets/js/86.3a1fc950.js"><link rel="prefetch" href="/assets/js/87.b09bdc02.js"><link rel="prefetch" href="/assets/js/88.82c34812.js"><link rel="prefetch" href="/assets/js/89.cb07e0be.js"><link rel="prefetch" href="/assets/js/9.c7fe16f1.js"><link rel="prefetch" href="/assets/js/90.45b8cec0.js"><link rel="prefetch" href="/assets/js/91.26f79b9b.js"><link rel="prefetch" href="/assets/js/92.b3a60e8d.js"><link rel="prefetch" href="/assets/js/93.4347c7a2.js"><link rel="prefetch" href="/assets/js/94.1ac2f9a1.js"><link rel="prefetch" href="/assets/js/95.237d3b46.js"><link rel="prefetch" href="/assets/js/96.66c6b700.js"><link rel="prefetch" href="/assets/js/97.cc860801.js"><link rel="prefetch" href="/assets/js/98.ad4bd215.js"><link rel="prefetch" href="/assets/js/99.75b5292a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7747ca4d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">戴鹏的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/basic/java-basic-oop.html" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/java/collection/java-collection-all.html" class="nav-link">Java 集合框架</a></li><li class="dropdown-item"><!----> <a href="/java/thread/java-thread.html" class="nav-link">Java 多线程与并发</a></li><li class="dropdown-item"><!----> <a href="/java/io/java-io.html" class="nav-link">Java IO/NIO/AIO</a></li><li class="dropdown-item"><!----> <a href="/java/java8/java8.html" class="nav-link">Java8 特性详解</a></li><li class="dropdown-item"><!----> <a href="/java/jvm/java-jvm-classload.html" class="nav-link">JVM 相关</a></li><li class="dropdown-item"><!----> <a href="/java/others/java-others-awesome-java.html" class="nav-link">Java 其它相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/spring.html" class="nav-link">Spring 基础</a></li><li class="dropdown-item"><!----> <a href="/spring/springboot-helloworld.html" class="nav-link">Spring Boot 入门</a></li><li class="dropdown-item"><!----> <a href="/spring/springboot-data-multi.html" class="nav-link">Spring Boot 进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/alg-basic-overview.html" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-sort-overview.html" class="nav-link">内部排序</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-core-divide-and-conquer.html" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-security-degist.html" class="nav-link">安全算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-distribute-overview.html" class="nav-link">分布式系统算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-other-mind.html" class="nav-link">其它算法相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>DB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/sql/sql-db.html" class="nav-link">数据库原理</a></li><li class="dropdown-subitem"><a href="/db/sql-lan/sql-lan.html" class="nav-link">SQL语言</a></li></ul></li><li class="dropdown-item"><h4>SQL DB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/sql-mysql/sql-mysql-theory.html" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL DB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/nosql-es/elasticsearch.html" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/db/nosql-mongo/mongo.html" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><span class="title">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/develop/protocol/dev-protocol-overview.html" class="nav-link">网络协议</a></li><li class="dropdown-item"><!----> <a href="/develop/usage/dev-usage-overview.html" class="nav-link">开发随手记</a></li></ul></div></div><div class="nav-item"><a href="/tbd.html" class="nav-link">架构</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><span class="title">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/tool/tool-git.html" class="nav-link">开发工具</a></li><li class="dropdown-item"><!----> <a href="/devops/linux/linux.html" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><a href="/tbd.html" class="nav-link">源码|项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="方法论" class="dropdown-title"><span class="title">方法论</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-rules.html" class="nav-link">开发原则(SOLID)</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-cap-base.html" class="nav-link">分布式理论(CAP&amp;BASE)</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-workflow.html" class="nav-link">开发流程</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-opensource.html" class="nav-link">开源协议</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/code-style/code-style-alibaba.html" class="nav-link">代码规范</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/pattern/1_overview.html" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/about/me/about-me.html" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/basic/java-basic-oop.html" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/java/collection/java-collection-all.html" class="nav-link">Java 集合框架</a></li><li class="dropdown-item"><!----> <a href="/java/thread/java-thread.html" class="nav-link">Java 多线程与并发</a></li><li class="dropdown-item"><!----> <a href="/java/io/java-io.html" class="nav-link">Java IO/NIO/AIO</a></li><li class="dropdown-item"><!----> <a href="/java/java8/java8.html" class="nav-link">Java8 特性详解</a></li><li class="dropdown-item"><!----> <a href="/java/jvm/java-jvm-classload.html" class="nav-link">JVM 相关</a></li><li class="dropdown-item"><!----> <a href="/java/others/java-others-awesome-java.html" class="nav-link">Java 其它相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/spring.html" class="nav-link">Spring 基础</a></li><li class="dropdown-item"><!----> <a href="/spring/springboot-helloworld.html" class="nav-link">Spring Boot 入门</a></li><li class="dropdown-item"><!----> <a href="/spring/springboot-data-multi.html" class="nav-link">Spring Boot 进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/alg-basic-overview.html" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-sort-overview.html" class="nav-link">内部排序</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-core-divide-and-conquer.html" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-security-degist.html" class="nav-link">安全算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-distribute-overview.html" class="nav-link">分布式系统算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/alg-other-mind.html" class="nav-link">其它算法相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>DB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/sql/sql-db.html" class="nav-link">数据库原理</a></li><li class="dropdown-subitem"><a href="/db/sql-lan/sql-lan.html" class="nav-link">SQL语言</a></li></ul></li><li class="dropdown-item"><h4>SQL DB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/sql-mysql/sql-mysql-theory.html" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL DB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/nosql-es/elasticsearch.html" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/db/nosql-mongo/mongo.html" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><span class="title">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/develop/protocol/dev-protocol-overview.html" class="nav-link">网络协议</a></li><li class="dropdown-item"><!----> <a href="/develop/usage/dev-usage-overview.html" class="nav-link">开发随手记</a></li></ul></div></div><div class="nav-item"><a href="/tbd.html" class="nav-link">架构</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><span class="title">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/tool/tool-git.html" class="nav-link">开发工具</a></li><li class="dropdown-item"><!----> <a href="/devops/linux/linux.html" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><a href="/tbd.html" class="nav-link">源码|项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="方法论" class="dropdown-title"><span class="title">方法论</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-rules.html" class="nav-link">开发原则(SOLID)</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-cap-base.html" class="nav-link">分布式理论(CAP&amp;BASE)</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-workflow.html" class="nav-link">开发流程</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/spec/dev-opensource.html" class="nav-link">开源协议</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/code-style/code-style-alibaba.html" class="nav-link">代码规范</a></li><li class="dropdown-item"><!----> <a href="/dev-spec/pattern/1_overview.html" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/about/me/about-me.html" class="nav-link">关于</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="sql语言-基础"><a href="#sql语言-基础" class="header-anchor">#</a> SQL语言 - 基础</h2> <h3 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h3> <p>模式定义了数据如何存储、存储什么样的数据以及数据如何分解等信息，数据库和表都有模式。</p> <p>主键的值不允许修改，也不允许复用（不能使用已经删除的主键值赋给新数据行的主键）。</p> <p>SQL（Structured Query Language)，标准 SQL 由 ANSI 标准委员会管理，从而称为 ANSI SQL。各个 DBMS 都有自己的实现，如 PL/SQL、Transact-SQL 等。</p> <p>SQL 语句不区分大小写，但是数据库表名、列名和值是否区分依赖于具体的 DBMS 以及配置。</p> <p>SQL 支持以下三种注释：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">## 注释</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span> <span class="token comment">-- 注释</span>
<span class="token comment">/* 注释1
   注释2 */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>数据库创建与使用：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> test<span class="token punctuation">;</span>
<span class="token keyword">USE</span> test<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="创建表"><a href="#创建表" class="header-anchor">#</a> 创建表</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  col1 <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
  col2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  col3 <span class="token keyword">DATE</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="修改表"><a href="#修改表" class="header-anchor">#</a> 修改表</h3> <p>添加列</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mytable
<span class="token keyword">ADD</span> col <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>删除列</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mytable
<span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> col<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>删除表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="插入"><a href="#插入" class="header-anchor">#</a> 插入</h3> <p>普通插入</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mytable<span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>插入检索出来的数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mytable1<span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> col1<span class="token punctuation">,</span> col2
<span class="token keyword">FROM</span> mytable2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>将一个表的内容插入到一个新表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> newtable <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="更新"><a href="#更新" class="header-anchor">#</a> 更新</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> mytable
<span class="token keyword">SET</span> col <span class="token operator">=</span> val
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>TRUNCATE TABLE</strong>  可以清空表，也就是删除所有行。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用更新和删除操作时一定要用 WHERE 子句，不然会把整张表的数据都破坏。可以先用 SELECT 语句进行测试，防止错误删除。</p> <h3 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h3> <h4 id="distinct"><a href="#distinct" class="header-anchor">#</a> DISTINCT</h4> <p>相同值只会出现一次。它作用于所有列，也就是说所有列的值都相同才算相同。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> col1<span class="token punctuation">,</span> col2
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="limit"><a href="#limit" class="header-anchor">#</a> LIMIT</h4> <p>限制返回的行数。可以有两个参数，第一个参数为起始行，从 0 开始；第二个参数为返回的总行数。</p> <p>返回前 5 行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>返回第 3 ~ 5 行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="排序"><a href="#排序" class="header-anchor">#</a> 排序</h3> <ul><li><strong>ASC</strong> ：升序（默认）</li> <li><strong>DESC</strong> ：降序</li></ul> <p>可以按多个列进行排序，并且为每个列指定不同的排序方式：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> col1 <span class="token keyword">DESC</span><span class="token punctuation">,</span> col2 <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="过滤"><a href="#过滤" class="header-anchor">#</a> 过滤</h3> <p>不进行过滤的数据非常大，导致通过网络传输了多余的数据，从而浪费了网络带宽。因此尽量使用 SQL 语句来过滤不必要的数据，而不是传输所有的数据到客户端中然后由客户端进行过滤。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下表显示了 WHERE 子句可用的操作符</p> <table><thead><tr><th style="text-align:center;">操作符</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">=</td> <td style="text-align:center;">等于</td></tr> <tr><td style="text-align:center;">&lt;</td> <td style="text-align:center;">小于</td></tr> <tr><td style="text-align:center;">&gt;</td> <td style="text-align:center;">大于</td></tr> <tr><td style="text-align:center;">&lt;&gt; !=</td> <td style="text-align:center;">不等于</td></tr> <tr><td style="text-align:center;">&lt;= !&gt;</td> <td style="text-align:center;">小于等于</td></tr> <tr><td style="text-align:center;">&gt;= !&lt;</td> <td style="text-align:center;">大于等于</td></tr> <tr><td style="text-align:center;">BETWEEN</td> <td style="text-align:center;">在两个值之间</td></tr> <tr><td style="text-align:center;">IS NULL</td> <td style="text-align:center;">为 NULL 值</td></tr></tbody></table> <p>应该注意到，NULL 与 0、空字符串都不同。</p> <p><strong>AND 和 OR</strong>  用于连接多个过滤条件。优先处理 AND，当一个过滤表达式涉及到多个 AND 和 OR 时，可以使用 () 来决定优先级，使得优先级关系更清晰。</p> <p><strong>IN</strong>  操作符用于匹配一组值，其后也可以接一个 SELECT 子句，从而匹配子查询得到的一组值。</p> <p><strong>NOT</strong>  操作符用于否定一个条件。</p> <h3 id="通配符"><a href="#通配符" class="header-anchor">#</a> 通配符</h3> <p>通配符也是用在过滤语句中，但它只能用于文本字段。</p> <ul><li><p><strong>%</strong>  匹配 &gt;=0 个任意字符；</p></li> <li><p><strong>_</strong>  匹配 ==1 个任意字符；</p></li> <li><p><strong>[ ]</strong>  可以匹配集合内的字符，例如 [ab] 将匹配字符 a 或者 b。用脱字符 ^ 可以对其进行否定，也就是不匹配集合内的字符。</p></li></ul> <p>使用 Like 来进行通配符匹配。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">LIKE</span> <span class="token string">'[^AB]%'</span><span class="token punctuation">;</span> <span class="token comment">-- 不以 A 和 B 开头的任意文本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不要滥用通配符，通配符位于开头处匹配会非常慢。</p> <h3 id="计算字段"><a href="#计算字段" class="header-anchor">#</a> 计算字段</h3> <p>在数据库服务器上完成数据的转换和格式化的工作往往比客户端上快得多，并且转换和格式化后的数据量更少的话可以减少网络通信量。</p> <p>计算字段通常需要使用  <strong>AS</strong>  来取别名，否则输出的时候字段名为计算表达式。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col1 <span class="token operator">*</span> col2 <span class="token keyword">AS</span> alias
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>CONCAT()</strong>  用于连接两个字段。许多数据库会使用空格把一个值填充为列宽，因此连接的结果会出现一些不必要的空格，使用 <strong>TRIM()</strong> 可以去除首尾空格。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>TRIM<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> TRIM<span class="token punctuation">(</span>col2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> concat_col
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h3> <p>各个 DBMS 的函数都是不相同的，因此不可移植，以下主要是 MySQL 的函数。</p> <h4 id="汇总"><a href="#汇总" class="header-anchor">#</a> 汇总</h4> <table><thead><tr><th style="text-align:center;">函 数</th> <th style="text-align:center;">说 明</th></tr></thead> <tbody><tr><td style="text-align:center;">AVG()</td> <td style="text-align:center;">返回某列的平均值</td></tr> <tr><td style="text-align:center;">COUNT()</td> <td style="text-align:center;">返回某列的行数</td></tr> <tr><td style="text-align:center;">MAX()</td> <td style="text-align:center;">返回某列的最大值</td></tr> <tr><td style="text-align:center;">MIN()</td> <td style="text-align:center;">返回某列的最小值</td></tr> <tr><td style="text-align:center;">SUM()</td> <td style="text-align:center;">返回某列值之和</td></tr></tbody></table> <p>AVG() 会忽略 NULL 行。</p> <p>使用 DISTINCT 可以让汇总函数值汇总不同的值。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> col1<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_col
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="文本处理"><a href="#文本处理" class="header-anchor">#</a> 文本处理</h4> <table><thead><tr><th style="text-align:center;">函数</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">LEFT()</td> <td style="text-align:center;">左边的字符</td></tr> <tr><td style="text-align:center;">RIGHT()</td> <td style="text-align:center;">右边的字符</td></tr> <tr><td style="text-align:center;">LOWER()</td> <td style="text-align:center;">转换为小写字符</td></tr> <tr><td style="text-align:center;">UPPER()</td> <td style="text-align:center;">转换为大写字符</td></tr> <tr><td style="text-align:center;">LTRIM()</td> <td style="text-align:center;">去除左边的空格</td></tr> <tr><td style="text-align:center;">RTRIM()</td> <td style="text-align:center;">去除右边的空格</td></tr> <tr><td style="text-align:center;">LENGTH()</td> <td style="text-align:center;">长度</td></tr> <tr><td style="text-align:center;">SOUNDEX()</td> <td style="text-align:center;">转换为语音值</td></tr></tbody></table> <p>其中， <strong>SOUNDEX()</strong>  可以将一个字符串转换为描述其语音表示的字母数字模式。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> SOUNDEX<span class="token punctuation">(</span>col1<span class="token punctuation">)</span> <span class="token operator">=</span> SOUNDEX<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="日期和时间处理"><a href="#日期和时间处理" class="header-anchor">#</a> 日期和时间处理</h4> <ul><li>日期格式：YYYY-MM-DD</li> <li>时间格式：HH:MM:SS</li></ul> <table><thead><tr><th style="text-align:center;">函 数</th> <th style="text-align:center;">说 明</th></tr></thead> <tbody><tr><td style="text-align:center;">AddDate()</td> <td style="text-align:center;">增加一个日期（天、周等）</td></tr> <tr><td style="text-align:center;">AddTime()</td> <td style="text-align:center;">增加一个时间（时、分等）</td></tr> <tr><td style="text-align:center;">CurDate()</td> <td style="text-align:center;">返回当前日期</td></tr> <tr><td style="text-align:center;">CurTime()</td> <td style="text-align:center;">返回当前时间</td></tr> <tr><td style="text-align:center;">Date()</td> <td style="text-align:center;">返回日期时间的日期部分</td></tr> <tr><td style="text-align:center;">DateDiff()</td> <td style="text-align:center;">计算两个日期之差</td></tr> <tr><td style="text-align:center;">Date_Add()</td> <td style="text-align:center;">高度灵活的日期运算函数</td></tr> <tr><td style="text-align:center;">Date_Format()</td> <td style="text-align:center;">返回一个格式化的日期或时间串</td></tr> <tr><td style="text-align:center;">Day()</td> <td style="text-align:center;">返回一个日期的天数部分</td></tr> <tr><td style="text-align:center;">DayOfWeek()</td> <td style="text-align:center;">对于一个日期，返回对应的星期几</td></tr> <tr><td style="text-align:center;">Hour()</td> <td style="text-align:center;">返回一个时间的小时部分</td></tr> <tr><td style="text-align:center;">Minute()</td> <td style="text-align:center;">返回一个时间的分钟部分</td></tr> <tr><td style="text-align:center;">Month()</td> <td style="text-align:center;">返回一个日期的月份部分</td></tr> <tr><td style="text-align:center;">Now()</td> <td style="text-align:center;">返回当前日期和时间</td></tr> <tr><td style="text-align:center;">Second()</td> <td style="text-align:center;">返回一个时间的秒部分</td></tr> <tr><td style="text-align:center;">Time()</td> <td style="text-align:center;">返回一个日期时间的时间部分</td></tr> <tr><td style="text-align:center;">Year()</td> <td style="text-align:center;">返回一个日期的年份部分</td></tr></tbody></table> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>2018-4-14 20:25:11
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="数值处理"><a href="#数值处理" class="header-anchor">#</a> 数值处理</h4> <table><thead><tr><th style="text-align:center;">函数</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">SIN()</td> <td style="text-align:center;">正弦</td></tr> <tr><td style="text-align:center;">COS()</td> <td style="text-align:center;">余弦</td></tr> <tr><td style="text-align:center;">TAN()</td> <td style="text-align:center;">正切</td></tr> <tr><td style="text-align:center;">ABS()</td> <td style="text-align:center;">绝对值</td></tr> <tr><td style="text-align:center;">SQRT()</td> <td style="text-align:center;">平方根</td></tr> <tr><td style="text-align:center;">MOD()</td> <td style="text-align:center;">余数</td></tr> <tr><td style="text-align:center;">EXP()</td> <td style="text-align:center;">指数</td></tr> <tr><td style="text-align:center;">PI()</td> <td style="text-align:center;">圆周率</td></tr> <tr><td style="text-align:center;">RAND()</td> <td style="text-align:center;">随机数</td></tr></tbody></table> <h3 id="分组"><a href="#分组" class="header-anchor">#</a> 分组</h3> <p>分组就是把具有相同的数据值的行放在同一组中。</p> <p>可以对同一分组数据使用汇总函数进行处理，例如求分组数据的平均值等。</p> <p>指定的分组字段除了能按该字段进行分组，也会自动按该字段进行排序。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> mytable
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>GROUP BY 自动按分组字段进行排序，ORDER BY 也可以按汇总字段来进行排序。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> mytable
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>WHERE 过滤行，HAVING 过滤分组，行过滤应当先于分组过滤。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">&gt;</span> <span class="token number">2</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col
<span class="token keyword">HAVING</span> num <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分组规定：</p> <ul><li>GROUP BY 子句出现在 WHERE 子句之后，ORDER BY 子句之前；</li> <li>除了汇总字段外，SELECT 语句中的每一字段都必须在 GROUP BY 子句中给出；</li> <li>NULL 的行会单独分为一组；</li> <li>大多数 SQL 实现不支持 GROUP BY 列具有可变长度的数据类型。</li></ul> <h3 id="子查询"><a href="#子查询" class="header-anchor">#</a> 子查询</h3> <p>子查询中只能返回一个字段的数据。</p> <p>可以将子查询的结果作为 WHRER 语句的过滤条件：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable1
<span class="token keyword">WHERE</span> col1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> col2
               <span class="token keyword">FROM</span> mytable2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>下面的语句可以检索出客户的订单数量，子查询语句会对第一个查询检索出的每个客户执行一次：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
                   <span class="token keyword">FROM</span> Orders
                   <span class="token keyword">WHERE</span> Orders<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> Customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span>
                   <span class="token keyword">AS</span> orders_num
<span class="token keyword">FROM</span> Customers
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cust_name<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="连接"><a href="#连接" class="header-anchor">#</a> 连接</h3> <p>连接用于连接多个表，使用 JOIN 关键字，并且条件语句使用 ON 而不是 WHERE。</p> <p>连接可以替换子查询，并且比子查询的效率一般会更快。</p> <p>可以用 AS 给列名、计算字段和表名取别名，给表名取别名是为了简化 SQL 语句以及连接相同表。</p> <h4 id="内连接"><a href="#内连接" class="header-anchor">#</a> 内连接</h4> <p>内连接又称等值连接，使用 INNER JOIN 关键字。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> B<span class="token punctuation">.</span><span class="token keyword">value</span>
<span class="token keyword">FROM</span> tablea <span class="token keyword">AS</span> A <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tableb <span class="token keyword">AS</span> B
<span class="token keyword">ON</span> A<span class="token punctuation">.</span><span class="token keyword">key</span> <span class="token operator">=</span> B<span class="token punctuation">.</span><span class="token keyword">key</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以不明确使用 INNER JOIN，而使用普通查询并在 WHERE 中将两个表中要连接的列用等值方法连接起来。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> B<span class="token punctuation">.</span><span class="token keyword">value</span>
<span class="token keyword">FROM</span> tablea <span class="token keyword">AS</span> A<span class="token punctuation">,</span> tableb <span class="token keyword">AS</span> B
<span class="token keyword">WHERE</span> A<span class="token punctuation">.</span><span class="token keyword">key</span> <span class="token operator">=</span> B<span class="token punctuation">.</span><span class="token keyword">key</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在没有条件语句的情况下返回笛卡尔积。</p> <h4 id="自连接"><a href="#自连接" class="header-anchor">#</a> 自连接</h4> <p>自连接可以看成内连接的一种，只是连接的表是自身而已。</p> <p>一张员工表，包含员工姓名和员工所属部门，要找出与 Jim 处在同一部门的所有员工姓名。</p> <p>子查询版本</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name
<span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> department <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token keyword">SELECT</span> department
      <span class="token keyword">FROM</span> employee
      <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&quot;Jim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>自连接版本</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e1<span class="token punctuation">.</span>name
<span class="token keyword">FROM</span> employee <span class="token keyword">AS</span> e1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">AS</span> e2
<span class="token keyword">ON</span> e1<span class="token punctuation">.</span>department <span class="token operator">=</span> e2<span class="token punctuation">.</span>department
      <span class="token operator">AND</span> e2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Jim&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="自然连接"><a href="#自然连接" class="header-anchor">#</a> 自然连接</h4> <p>自然连接是把同名列通过等值测试连接起来的，同名列可以有多个。</p> <p>内连接和自然连接的区别：内连接提供连接的列，而自然连接自动连接所有同名列。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> B<span class="token punctuation">.</span><span class="token keyword">value</span>
<span class="token keyword">FROM</span> tablea <span class="token keyword">AS</span> A <span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span> tableb <span class="token keyword">AS</span> B<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="外连接"><a href="#外连接" class="header-anchor">#</a> 外连接</h4> <p>外连接保留了没有关联的那些行。分为左外连接，右外连接以及全外连接，左外连接就是保留左表没有关联的行。</p> <p>检索所有顾客的订单信息，包括还没有订单信息的顾客。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> Orders<span class="token punctuation">.</span>order_num
<span class="token keyword">FROM</span> Customers <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> Orders
<span class="token keyword">ON</span> Customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> Orders<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>customers 表：</p> <table><thead><tr><th style="text-align:center;">cust_id</th> <th style="text-align:center;">cust_name</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">a</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">b</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">c</td></tr></tbody></table> <p>orders 表：</p> <table><thead><tr><th style="text-align:center;">order_id</th> <th style="text-align:center;">cust_id</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">3</td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">3</td></tr></tbody></table> <p>结果：</p> <table><thead><tr><th style="text-align:center;">cust_id</th> <th style="text-align:center;">cust_name</th> <th style="text-align:center;">order_id</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">a</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">1</td> <td style="text-align:center;">a</td> <td style="text-align:center;">2</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">c</td> <td style="text-align:center;">3</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">c</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">b</td> <td style="text-align:center;">Null</td></tr></tbody></table> <h3 id="组合查询"><a href="#组合查询" class="header-anchor">#</a> 组合查询</h3> <p>使用  <strong>UNION</strong>  来组合两个查询，如果第一个查询返回 M 行，第二个查询返回 N 行，那么组合查询的结果一般为 M+N 行。</p> <p>每个查询必须包含相同的列、表达式和聚集函数。</p> <p>默认会去除相同行，如果需要保留相同行，使用 UNION ALL。</p> <p>只能包含一个 ORDER BY 子句，并且必须位于语句的最后。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> col
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="视图"><a href="#视图" class="header-anchor">#</a> 视图</h3> <p>视图是虚拟的表，本身不包含数据，也就不能对其进行索引操作。</p> <p>对视图的操作和对普通表的操作一样。</p> <p>视图具有如下好处：</p> <ul><li>简化复杂的 SQL 操作，比如复杂的连接；</li> <li>只使用实际表的一部分数据；</li> <li>通过只给用户访问视图的权限，保证数据的安全性；</li> <li>更改数据格式和表示。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> myview <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span> <span class="token keyword">AS</span> concat_col<span class="token punctuation">,</span> col3<span class="token operator">*</span>col4 <span class="token keyword">AS</span> compute_col
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col5 <span class="token operator">=</span> val<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="存储过程"><a href="#存储过程" class="header-anchor">#</a> 存储过程</h3> <p>存储过程可以看成是对一系列 SQL 操作的批处理。</p> <p>使用存储过程的好处：</p> <ul><li>代码封装，保证了一定的安全性；</li> <li>代码复用；</li> <li>由于是预先编译，因此具有很高的性能。</li></ul> <p>命令行中创建存储过程需要自定义分隔符，因为命令行是以 ; 为结束符，而存储过程中也包含了分号，因此会错误把这部分分号当成是结束符，造成语法错误。</p> <p>包含 in、out 和 inout 三种参数。</p> <p>给变量赋值都需要用 select into 语句。</p> <p>每次只能给一个变量赋值，不支持集合的操作。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token comment">//</span>

<span class="token keyword">create</span> <span class="token keyword">procedure</span> myprocedure<span class="token punctuation">(</span> <span class="token keyword">out</span> ret <span class="token keyword">int</span> <span class="token punctuation">)</span>
    <span class="token keyword">begin</span>
        <span class="token keyword">declare</span> y <span class="token keyword">int</span><span class="token punctuation">;</span>
        <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>col1<span class="token punctuation">)</span>
        <span class="token keyword">from</span> mytable
        <span class="token keyword">into</span> y<span class="token punctuation">;</span>
        <span class="token keyword">select</span> y<span class="token operator">*</span>y <span class="token keyword">into</span> ret<span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token comment">//</span>

<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">call</span> myprocedure<span class="token punctuation">(</span><span class="token variable">@ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token variable">@ret</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="游标"><a href="#游标" class="header-anchor">#</a> 游标</h3> <p>在存储过程中使用游标可以对一个结果集进行移动遍历。</p> <p>游标主要用于交互式应用，其中用户需要对数据集中的任意行进行浏览和修改。</p> <p>使用游标的四个步骤：</p> <ol><li>声明游标，这个过程没有实际检索出数据；</li> <li>打开游标；</li> <li>取出数据；</li> <li>关闭游标；</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token comment">//</span>
<span class="token keyword">create</span> <span class="token keyword">procedure</span> myprocedure<span class="token punctuation">(</span><span class="token keyword">out</span> ret <span class="token keyword">int</span><span class="token punctuation">)</span>
    <span class="token keyword">begin</span>
        <span class="token keyword">declare</span> done <span class="token keyword">boolean</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">declare</span> mycursor <span class="token keyword">cursor</span> <span class="token keyword">for</span>
        <span class="token keyword">select</span> col1 <span class="token keyword">from</span> mytable<span class="token punctuation">;</span>
        <span class="token comment">## 定义了一个 continue handler，当 sqlstate '02000' 这个条件出现时，会执行 set done = 1</span>
        <span class="token keyword">declare</span> <span class="token keyword">continue</span> <span class="token keyword">handler</span> <span class="token keyword">for</span> sqlstate <span class="token string">'02000'</span> <span class="token keyword">set</span> done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">open</span> mycursor<span class="token punctuation">;</span>

        <span class="token keyword">repeat</span>
            <span class="token keyword">fetch</span> mycursor <span class="token keyword">into</span> ret<span class="token punctuation">;</span>
            <span class="token keyword">select</span> ret<span class="token punctuation">;</span>
        until done <span class="token keyword">end</span> <span class="token keyword">repeat</span><span class="token punctuation">;</span>

        <span class="token keyword">close</span> mycursor<span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token comment">//</span>
 <span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="触发器"><a href="#触发器" class="header-anchor">#</a> 触发器</h3> <p>触发器会在某个表执行以下语句时而自动执行：DELETE、INSERT、UPDATE。</p> <p>触发器必须指定在语句执行之前还是之后自动执行，之前执行使用 BEFORE 关键字，之后执行使用 AFTER 关键字。BEFORE 用于数据验证和净化，AFTER 用于审计跟踪，将修改记录到另外一张表中。</p> <p>INSERT 触发器包含一个名为 NEW 的虚拟表。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> mytrigger <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> mytable
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>col <span class="token keyword">into</span> <span class="token variable">@result</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@result</span><span class="token punctuation">;</span> <span class="token comment">-- 获取结果</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>DELETE 触发器包含一个名为 OLD 的虚拟表，并且是只读的。</p> <p>UPDATE 触发器包含一个名为 NEW 和一个名为 OLD 的虚拟表，其中 NEW 是可以被修改的，而 OLD 是只读的。</p> <p>MySQL 不允许在触发器中使用 CALL 语句，也就是不能调用存储过程。</p> <h3 id="事务管理"><a href="#事务管理" class="header-anchor">#</a> 事务管理</h3> <p>基本术语：</p> <ul><li>事务（transaction）指一组 SQL 语句；</li> <li>回退（rollback）指撤销指定 SQL 语句的过程；</li> <li>提交（commit）指将未存储的 SQL 语句结果写入数据库表；</li> <li>保留点（savepoint）指事务处理中设置的临时占位符（placeholder），你可以对它发布回退（与回退整个事务处理不同）。</li></ul> <p>不能回退 SELECT 语句，回退 SELECT 语句也没意义；也不能回退 CREATE 和 DROP 语句。</p> <p>MySQL 的事务提交默认是隐式提交，每执行一条语句就把这条语句当成一个事务然后进行提交。当出现 START TRANSACTION 语句时，会关闭隐式提交；当 COMMIT 或 ROLLBACK 语句执行后，事务会自动关闭，重新恢复隐式提交。</p> <p>通过设置 autocommit 为 0 可以取消自动提交；autocommit 标记是针对每个连接而不是针对服务器的。</p> <p>如果没有设置保留点，ROLLBACK 会回退到 START TRANSACTION 语句处；如果设置了保留点，并且在 ROLLBACK 中指定该保留点，则会回退到该保留点。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span>
<span class="token comment">// ...</span>
<span class="token keyword">SAVEPOINT</span> delete1
<span class="token comment">// ...</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> delete1
<span class="token comment">// ...</span>
<span class="token keyword">COMMIT</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="字符集"><a href="#字符集" class="header-anchor">#</a> 字符集</h3> <p>基本术语：</p> <ul><li>字符集为字母和符号的集合；</li> <li>编码为某个字符集成员的内部表示；</li> <li>校对字符指定如何比较，主要用于排序和分组。</li></ul> <p>除了给表指定字符集和校对外，也可以给列指定：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable
<span class="token punctuation">(</span>col <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> latin <span class="token keyword">COLLATE</span> latin1_general_ci <span class="token punctuation">)</span>
<span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> hebrew <span class="token keyword">COLLATE</span> hebrew_general_ci<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以在排序、分组时指定校对：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> col <span class="token keyword">COLLATE</span> latin1_general_ci<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="权限管理"><a href="#权限管理" class="header-anchor">#</a> 权限管理</h3> <p>MySQL 的账户信息保存在 mysql 这个数据库中。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>创建账户</strong></p> <p>新创建的账户没有任何权限。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> myuser IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'mypassword'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>修改账户名</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">RENAME</span> myuser <span class="token keyword">TO</span> newuser<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>删除账户</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> myuser<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>查看权限</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> myuser<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>授予权限</strong></p> <p>账户用 username@host 的形式定义，username@% 使用的是默认主机名。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> mydatabase<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> myuser<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>删除权限</strong></p> <p>GRANT 和 REVOKE 可在几个层次上控制访问权限：</p> <ul><li>整个服务器，使用 GRANT ALL 和 REVOKE ALL；</li> <li>整个数据库，使用 ON database.*；</li> <li>特定的表，使用 ON database.table；</li> <li>特定的列；</li> <li>特定的存储过程。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> mydatabase<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>更改密码</strong></p> <p>必须使用 Password() 函数</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWROD <span class="token keyword">FOR</span> myuser <span class="token operator">=</span> Password<span class="token punctuation">(</span><span class="token string">'new_password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h3> <ul><li>BenForta. SQL 必知必会 [M]. 人民邮电出版社, 2013.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8de273a3.js" defer></script><script src="/assets/js/2.c16f9978.js" defer></script><script src="/assets/js/64.75a8a6ce.js" defer></script>
  </body>
</html>
